{"version":3,"sources":["../src/savings.js"],"names":["BBSavings","loginCookie","accountsUrl","BASE_ENDPOINT","headers","DEFAULT_HEADERS","cookie","response","text","json","JSON","parse","sessions","conteiner","telas","sessoes","title","cabecalho","variations","celulas","map","c","acao","split","splice","variation","parseInt","v","description","year","month","pad","s","toString","padStart","params","metodo","variacao","periodo","querystring","stringify","session","find","includes","componentes","filter","comp","texto","date","Date","amount"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;IAEqBA,S;AAGnB,qBAAYC,WAAZ,EAAyB;AAAA;AAAA,SAFzBA,WAEyB,GAFX,IAEW;;AACvB,SAAKA,WAAL,GAAmBA,WAAnB;AACD;;;;;;;;;;;AAGOC,2B,GAAc,gC;;uBAEG,8BAASC,wBAAT,GAAyBD,WAAzB,EAAwC;AAC7DE,sDACKC,0BADL;AAEEC,4BAAQ,KAAKL;AAFf;AAD6D,iBAAxC,C;;;AAAjBM,wB;;uBAOaA,SAASC,IAAT,E;;;AAAbA,oB;AACAC,oB,GAAOC,KAAKC,KAAL,CAAWH,IAAX,C;AAEPI,wB,GAAWH,KAAKI,SAAL,CAAeC,KAAf,CAAqB,CAArB,EAAwBC,OAAxB,CAAgC,CAAhC,C;AACXC,qB,GAAQJ,SAASK,S;AACjBC,0B,GAAaN,SAASO,OAAT,CAAiBC,GAAjB,CAAqB;AAAA,yBAAKC,EAAEC,IAAF,CAAOC,KAAP,CAAa,WAAb,EAA0BC,MAA1B,CAAiC,CAAC,CAAlC,EAAqC,CAArC,CAAL;AAAA,iBAArB,C;iDAEZN,WAAWE,GAAX,CAAe;AAAA,yBAAM;AAC1BK,+BAAWC,SAASC,CAAT,EAAY,EAAZ,CADe;AAE1BC,iCAAgBZ,KAAhB,0BAAoCW;AAFV,mBAAN;AAAA,iBAAf,C;;;;;;;;;;;;;;;;;;;;YAMeF,S,SAAAA,S;YAAWI,I,SAAAA,I;YAAMC,K,SAAAA,K;;;;;;AACjCC,mB,GAAM,SAANA,GAAM;AAAA,yBAAKC,EAAEC,QAAF,GAAaC,QAAb,CAAsB,GAAtB,EAA2B,CAA3B,CAAL;AAAA,iB;;AACNhC,2B,GAAc,oC;AACdiC,sB,GAAS;AACbC,0BAAQ,aADK;AAEbC,4BAAUZ,SAFG;AAGba,mCAAeP,IAAID,KAAJ,CAAf,SAA6BD;AAHhB,iB;;uBAMQ,8BAClB1B,wBADkB,GACFD,WADE,SACaqC,sBAAYC,SAAZ,CAAsBL,MAAtB,CADb,EAErB;AACE/B,sDACKC,0BADL;AAEEC,4BAAQ,KAAKL;AAFf;AADF,iBAFqB,C;;;AAAjBM,wB;;uBAUaA,SAASC,IAAT,E;;;AAAbA,oB;AACAC,oB,GAAOC,KAAKC,KAAL,CAAWH,IAAX,C;AAEPiC,uB,GAAUhC,KAAKI,SAAL,CAAeC,KAAf,CAAqB,CAArB,EAAwBC,OAAxB,CAAgC2B,IAAhC,CAAqC;AAAA,yBAAKV,EAAEf,SAAF,IAAee,EAAEf,SAAF,CAAY0B,QAAZ,CAAqB,gBAArB,CAApB;AAAA,iBAArC,C;kDACTF,QAAQtB,OAAR,CACJC,GADI,CACA;AAAA,yBAAKC,EAAEuB,WAAP;AAAA,iBADA,EAEJC,MAFI,CAEG;AAAA,yBAAQC,KAAK,CAAL,EAAQF,WAAR,CAAoB,CAApB,EAAuBG,KAAvB,KAAiC,KAAzC;AAAA,iBAFH,EAGJ3B,GAHI,CAGA;AAAA,yBAAM;AACT4B,0BAAM,IAAIC,IAAJ,CAASpB,IAAT,EAAeC,QAAQ,CAAvB,EAA0BT,EAAE,CAAF,EAAKuB,WAAL,CAAiB,CAAjB,EAAoBG,KAA9C,CADG;AAETnB,iCAAa,+BAAiBP,EAAE,CAAF,EAAKuB,WAAL,CAAiB,CAAjB,EAAoBG,KAArC,CAFJ;AAGTG,4BAAQ,gCAAkB7B,EAAE,CAAF,EAAKuB,WAAL,CAAiB,CAAjB,EAAoBG,KAAtC;AAHC,mBAAN;AAAA,iBAHA,C;;;;;;;;;;;;;;;;;;;;kBArDU/C,S","file":"savings.js","sourcesContent":["import fetch from 'node-fetch';\nimport querystring from 'querystring';\nimport { BASE_ENDPOINT, DEFAULT_HEADERS } from './constants';\nimport { treatDescription, parseAmountString } from './helpers';\n\nexport default class BBSavings {\n  loginCookie = null;\n\n  constructor(loginCookie) {\n    this.loginCookie = loginCookie;\n  }\n\n  async getAccounts() {\n    const accountsUrl = 'tela/ExtratoDePoupanca/entrada';\n\n    const response = await fetch(`${BASE_ENDPOINT}${accountsUrl}`, {\n      headers: {\n        ...DEFAULT_HEADERS,\n        cookie: this.loginCookie,\n      },\n    });\n\n    const text = await response.text();\n    const json = JSON.parse(text);\n\n    const sessions = json.conteiner.telas[0].sessoes[0];\n    const title = sessions.cabecalho;\n    const variations = sessions.celulas.map(c => c.acao.split('variacao=').splice(-1)[0]);\n\n    return variations.map(v => ({\n      variation: parseInt(v, 10),\n      description: `${title} - Variação ${v}`,\n    }));\n  }\n\n  async getTransactions({ variation, year, month }) {\n    const pad = s => s.toString().padStart('0', 2);\n    const accountsUrl = 'tela/ExtratoDePoupanca/menuPeriodo';\n    const params = {\n      metodo: 'mesAnterior',\n      variacao: variation,\n      periodo: `01/${pad(month)}/${year}`,\n    };\n\n    const response = await fetch(\n      `${BASE_ENDPOINT}${accountsUrl}?${querystring.stringify(params)}`,\n      {\n        headers: {\n          ...DEFAULT_HEADERS,\n          cookie: this.loginCookie,\n        },\n      },\n    );\n\n    const text = await response.text();\n    const json = JSON.parse(text);\n\n    const session = json.conteiner.telas[0].sessoes.find(s => s.cabecalho && s.cabecalho.includes('Mês referência'));\n    return session.celulas\n      .map(c => c.componentes)\n      .filter(comp => comp[0].componentes[0].texto !== 'Dia')\n      .map(c => ({\n        date: new Date(year, month - 1, c[0].componentes[0].texto),\n        description: treatDescription(c[1].componentes[0].texto),\n        amount: parseAmountString(c[2].componentes[0].texto),\n      }));\n  }\n}\n"]}