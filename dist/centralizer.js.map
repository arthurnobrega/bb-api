{"version":3,"sources":["../src/centralizer.js"],"names":["apiEndpoint","transactionsUrl","headers","Centralizer","loginHash","loginCookie","refreshHash","hashUrl","params","id","method","body","querystring","stringify","response","text","login","branch","account","password","loginUrl","idh","dependenciaOrigem","numeroContratoOrigem","idDispositivo","senhaConta","get","JSON","parse","getBalance","balanceUrl","cookie","servicoSaldo","saldo","parts","split","isPositive","balance","parseFloat","replace"],"mappings":"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","file":"centralizer.js","sourcesContent":["import fetch from 'node-fetch'\nimport querystring from 'querystring'\n\nconst apiEndpoint = 'https://mobi.bb.com.br/mov-centralizador/'\n\nconst transactionsUrl = 'tela/ExtratoDeContaCorrente/extrato'\n\nconst headers = {\n  'User-Agent': 'Android;Google Nexus 5 - 6.0.0 - API 23 - 1080x1920;Android;6.0;vbox86p-userdebug 6.0 MRA58K eng.buildbot.20160110.195928 test-keys;mov-android-app;6.14.0.1;en_US;cpu=0|clock=|ram=2052484 kB|espacoSDInterno=12.46 GB|isSmartphone=true|nfc=false|camera=true|cameraFrontal=true|root=true|reconhecimentoVoz=false|resolucao=1080_1776|densidade=3.0|',\n  'Content-Type': 'application/x-www-form-urlencoded',\n  'Cache-Control': 'no-cache',\n  'Postman-Token': '7ac0e5e1-8b39-457d-ae08-52c82b41bd5b',\n}\n\nexport default class Centralizer {\n  loginHash = null\n  loginCookie = null\n\n  refreshHash = async () => {\n    const hashUrl = 'hash'\n    const params = { id: '00000000000000000000000000000000' }\n\n    const response = await fetch(`${apiEndpoint}${hashUrl}`, {\n      headers,\n      method: 'POST',\n      body: querystring.stringify(params),\n    })\n\n    this.loginHash = await response.text()\n\n    return this.loginHash\n  }\n\n  login = async ({ branch, account, password }) => {\n    const loginUrl = 'servico/ServicoLogin/login'\n    await this.refreshHash()\n\n    const params = {\n      idh: this.loginHash,\n      dependenciaOrigem: branch,\n      numeroContratoOrigem: account,\n      idDispositivo: account,\n      senhaConta: password,\n    }\n\n    const response = await fetch(`${apiEndpoint}${loginUrl}`, {\n      headers,\n      method: 'POST',\n      body: querystring.stringify(params),\n    })\n\n    this.loginCookie = response.headers.get('set-cookie')\n\n    const text = await response.text()\n    const { login } = JSON.parse(text)\n\n    return login\n  }\n\n  getBalance = async () => {\n    const balanceUrl = 'servico/ServicoSaldo/saldo'\n    const params = { idh: 'f197ca41bbcd28cb2571241b76974d7fbdbcc6364028a2fdb3d232af4b5ad67054b0191e0cd8a5b7' }\n\n    const response = await fetch(`${apiEndpoint}${balanceUrl}`, {\n      headers: {\n        ...headers,\n        cookie: this.loginCookie,\n      },\n      method: 'POST',\n      body: querystring.stringify(params),\n    })\n\n    const text = await response.text()\n    const { servicoSaldo } = JSON.parse(text)\n    const { saldo } = servicoSaldo\n\n    const parts = saldo.split(' ')\n    const isPositive = parts[1] === 'C'\n\n    const balance = parseFloat(parts[0].replace('.', '').replace(',', '.'))\n\n    return isPositive ? balance : -balance\n  }\n}\n"]}