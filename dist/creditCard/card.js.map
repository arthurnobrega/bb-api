{"version":3,"sources":["../../src/creditCard/card.js"],"names":["BBCard","brand","modality","cardAccountNumber","cardNumber","billsUrl","params","codigoModalidade","numeroContaCartao","numeroPlastico","BASE_ENDPOINT","headers","DEFAULT_HEADERS","cookie","LoginCookie","getGlobal","method","body","querystring","stringify","response","text","json","JSON","parse","bills","conteiner","telas","sessoes","celulas","map","c","protocolo","parametros","p","reduce","acc","BBCardBill","billId","sequencialFatura","billDate","dataFatura","status","openedBillDate","slice","parseInt","toString","padStart","unshift"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;IAEqBA,M;AACnB,wBAAgE;AAAA,QAAlDC,KAAkD,QAAlDA,KAAkD;AAAA,QAA3CC,QAA2C,QAA3CA,QAA2C;AAAA,QAAjCC,iBAAiC,QAAjCA,iBAAiC;AAAA,QAAdC,UAAc,QAAdA,UAAc;AAAA;;AAC9D,SAAKH,KAAL,GAAaA,KAAb;AACA,SAAKC,QAAL,GAAgBA,QAAhB;AACA,SAAKC,iBAAL,GAAyBA,iBAAzB;AACA,SAAKC,UAAL,GAAkBA,UAAlB;AACD;;;;;;;;;;;;;AAGOC,wB,GAAW,gC;AAEXC,sB,GAAS;AACbC,oCAAkB,KAAKL,QADV;AAEbM,qCAAmB,KAAKL,iBAFX;AAGbM,kCAAgB,KAAKL;AAHR,iB;;uBAMQ,8BAASM,wBAAT,GAAyBL,QAAzB,EAAqC;AAC1DM,sDACKC,0BADL;AAEEC,4BAAQC,sBAAYC,SAAZ;AAFV,oBAD0D;AAK1DC,0BAAQ,MALkD;AAM1DC,wBAAMC,sBAAYC,SAAZ,CAAsBb,MAAtB;AANoD,iBAArC,C;;;AAAjBc,wB;;uBASaA,SAASC,IAAT,E;;;AAAbA,oB;AACAC,oB,GAAOC,KAAKC,KAAL,CAAWH,IAAX,C;AAEPI,qB,GAAQH,KAAKI,SAAL,CAAeC,KAAf,CAAqB,CAArB,EAAwBC,OAAxB,CAAgC,CAAhC,EAAmCC,OAAnC,CACXC,GADW,CACP;AAAA,yBACHC,EAAEC,SAAF,CAAYC,UAAZ,CACGH,GADH,CACO;AAAA,6DAASI,EAAE,CAAF,CAAT,EAAgBA,EAAE,CAAF,CAAhB;AAAA,mBADP,EAEGC,MAFH,CAEU,UAACC,GAAD,EAAMF,CAAN;AAAA,sDAAkBE,GAAlB,EAA0BF,CAA1B;AAAA,mBAFV,EAE0C,EAF1C,CADG;AAAA,iBADO,EAMXJ,GANW,CAOV;AAAA,yBACE,IAAIO,kBAAJ,CAAe;AACblC,uCAAmB,MAAKA,iBADX;AAEbmC,4BAAQJ,EAAEK,gBAFG;AAGbC,8BAAUN,EAAEO,UAHC;AAIbC,4BAAQ;AAJK,mBAAf,CADF;AAAA,iBAPU,C;AAgBRC,8B,GACJlB,MAAM,CAAN,EAASe,QAAT,CAAkBI,KAAlB,CAAwB,CAAxB,EAA2B,CAA3B,IACA,CAACC,SAASpB,MAAM,CAAN,EAASe,QAAT,CAAkBI,KAAlB,CAAwB,CAAxB,EAA2B,CAA3B,CAAT,EAAwC,EAAxC,IAA8C,CAA/C,EACGE,QADH,GAEGC,QAFH,CAEY,CAFZ,EAEe,GAFf,CADA,GAIAtB,MAAM,CAAN,EAASe,QAAT,CAAkBI,KAAlB,CAAwB,CAAxB,EAA2B,CAA3B,C;;;AAEFnB,sBAAMuB,OAAN,CACE,IAAIX,kBAAJ,CAAe;AACblC,qCAAmBsB,MAAM,CAAN,EAAStB,iBADf;AAEbqC,4BAAUG,cAFG;AAGbD,0BAAQ;AAHK,iBAAf,CADF;;iDAQOjB,K;;;;;;;;;;;;;;;;;;;;kBA5DUzB,M","file":"card.js","sourcesContent":["import fetch from 'node-fetch';\nimport querystring from 'querystring';\nimport LoginCookie from '../loginCookie';\nimport BBCardBill from './cardBill';\nimport { BASE_ENDPOINT, DEFAULT_HEADERS } from '../constants';\n\nexport default class BBCard {\n  constructor({ brand, modality, cardAccountNumber, cardNumber }) {\n    this.brand = brand;\n    this.modality = modality;\n    this.cardAccountNumber = cardAccountNumber;\n    this.cardNumber = cardNumber;\n  }\n\n  async getBills() {\n    const billsUrl = 'tela/ExtratoFatura/mesAnterior';\n\n    const params = {\n      codigoModalidade: this.modality,\n      numeroContaCartao: this.cardAccountNumber,\n      numeroPlastico: this.cardNumber,\n    };\n\n    const response = await fetch(`${BASE_ENDPOINT}${billsUrl}`, {\n      headers: {\n        ...DEFAULT_HEADERS,\n        cookie: LoginCookie.getGlobal(),\n      },\n      method: 'POST',\n      body: querystring.stringify(params),\n    });\n\n    const text = await response.text();\n    const json = JSON.parse(text);\n\n    const bills = json.conteiner.telas[0].sessoes[0].celulas\n      .map(c =>\n        c.protocolo.parametros\n          .map(p => ({ [p[0]]: p[1] }))\n          .reduce((acc, p) => ({ ...acc, ...p }), {}),\n      )\n      .map(\n        p =>\n          new BBCardBill({\n            cardAccountNumber: this.cardAccountNumber,\n            billId: p.sequencialFatura,\n            billDate: p.dataFatura,\n            status: 'closed',\n          }),\n      );\n\n    const openedBillDate =\n      bills[0].billDate.slice(0, 2) +\n      (parseInt(bills[0].billDate.slice(2, 4), 10) + 1)\n        .toString()\n        .padStart(2, '0') +\n      bills[0].billDate.slice(4, 8);\n\n    bills.unshift(\n      new BBCardBill({\n        cardAccountNumber: bills[0].cardAccountNumber,\n        billDate: openedBillDate,\n        status: 'opened',\n      }),\n    );\n\n    return bills;\n  }\n}\n"]}