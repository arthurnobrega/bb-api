{"version":3,"sources":["../src/bb.js"],"names":["refreshHash","hashUrl","params","id","BASE_ENDPOINT","headers","DEFAULT_HEADERS","method","body","querystring","stringify","response","text","hash","BB","loginCookie","checking","savings","branch","account","password","loginUrl","idh","dependenciaOrigem","numeroContratoOrigem","senhaConta","titularidade","get","JSON","parse","login","BBChecking","BBSavings"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;;;AAEA,IAAMA;AAAA,sFAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AACZC,mBADY,GACF,MADE;AAEZC,kBAFY,GAEH,EAAEC,IAAI,kCAAN,EAFG;AAAA;AAAA,mBAIK,8BAASC,wBAAT,GAAyBH,OAAzB,EAAoC;AACzDI,uBAASC,0BADgD;AAEzDC,sBAAQ,MAFiD;AAGzDC,oBAAMC,sBAAYC,SAAZ,CAAsBR,MAAtB;AAHmD,aAApC,CAJL;;AAAA;AAIZS,oBAJY;AAAA;AAAA,mBAUCA,SAASC,IAAT,EAVD;;AAAA;AAUZC,gBAVY;AAAA,6CAYXA,IAZW;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAd;;AAAA;AAAA;AAAA;AAAA,GAAN;;IAeqBC,E;;;SACnBC,W,GAAc,I;SACdC,Q,GAAW,I;SACXC,O,GAAU,I;;;;;;;YAEIC,M,SAAAA,M;YAAQC,O,SAAAA,O;YAASC,Q,SAAAA,Q;;;;;;;;AACvBC,wB,GAAW,4B;;uBACErB,a;;;AAAba,oB;AAEAX,sB,GAAS;AACboB,uBAAKT,IADQ;AAEbU,qCAAmBL,MAFN;AAGbM,wCAAsBL,OAHT;AAIbM,8BAAYL,QAJC;AAKbM,gCAAc;AALD,iB;;uBAQQ,8BAAStB,wBAAT,GAAyBiB,QAAzB,EAAqC;AAC1DhB,2BAASC,0BADiD;AAE1DC,0BAAQ,MAFkD;AAG1DC,wBAAMC,sBAAYC,SAAZ,CAAsBR,MAAtB;AAHoD,iBAArC,C;;;AAAjBS,wB;;;AAMN,qBAAKI,WAAL,GAAmBJ,SAASN,OAAT,CAAiBsB,GAAjB,CAAqB,YAArB,CAAnB;;;uBAEmBhB,SAASC,IAAT,E;;;AAAbA,oB;8BACYgB,KAAKC,KAAL,CAAWjB,IAAX,C,EAAVkB,K,eAAAA,K;;;AAER,qBAAKd,QAAL,GAAgB,IAAIe,kBAAJ,CAAe,KAAKhB,WAApB,CAAhB;AACA,qBAAKE,OAAL,GAAe,IAAIe,iBAAJ,CAAc,KAAKjB,WAAnB,CAAf;;kDAEOe,K;;;;;;;;;;;;;;;;;;;;kBA/BUhB,E","file":"bb.js","sourcesContent":["import fetch from 'node-fetch';\nimport querystring from 'querystring';\nimport { BASE_ENDPOINT, DEFAULT_HEADERS } from './constants';\nimport BBChecking from './checking';\nimport BBSavings from './savings';\n\nconst refreshHash = async () => {\n  const hashUrl = 'hash';\n  const params = { id: '00000000000000000000000000000000' };\n\n  const response = await fetch(`${BASE_ENDPOINT}${hashUrl}`, {\n    headers: DEFAULT_HEADERS,\n    method: 'POST',\n    body: querystring.stringify(params),\n  });\n\n  const hash = await response.text();\n\n  return hash;\n};\n\nexport default class BB {\n  loginCookie = null;\n  checking = null;\n  savings = null;\n\n  async login({ branch, account, password }) {\n    const loginUrl = 'servico/ServicoLogin/login';\n    const hash = await refreshHash();\n\n    const params = {\n      idh: hash,\n      dependenciaOrigem: branch,\n      numeroContratoOrigem: account,\n      senhaConta: password,\n      titularidade: '1',\n    };\n\n    const response = await fetch(`${BASE_ENDPOINT}${loginUrl}`, {\n      headers: DEFAULT_HEADERS,\n      method: 'POST',\n      body: querystring.stringify(params),\n    });\n\n    this.loginCookie = response.headers.get('set-cookie');\n\n    const text = await response.text();\n    const { login } = JSON.parse(text);\n\n    this.checking = new BBChecking(this.loginCookie);\n    this.savings = new BBSavings(this.loginCookie);\n\n    return login;\n  }\n}\n"]}