{"version":3,"sources":["../../src/savings/savingsAccount.js"],"names":["BBSavingsAccount","variation","description","year","month","pad","s","toString","padStart","accountsUrl","params","metodo","variacao","periodo","BASE_ENDPOINT","querystring","stringify","headers","DEFAULT_HEADERS","cookie","LoginCookie","getGlobal","response","text","json","JSON","parse","session","conteiner","telas","sessoes","find","cabecalho","includes","celulas","map","c","componentes","filter","comp","texto","date","Date","amount"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;IAEqBA,gB;AACnB,kCAAwC;AAAA,QAA1BC,SAA0B,QAA1BA,SAA0B;AAAA,QAAfC,WAAe,QAAfA,WAAe;AAAA;;AACtC,SAAKD,SAAL,GAAiBA,SAAjB;AACA,SAAKC,WAAL,GAAmBA,WAAnB;AACD;;;;;;YAEuBC,I,SAAAA,I;YAAMC,K,SAAAA,K;;;;;;AACtBC,mB,GAAM,SAANA,GAAM;AAAA,yBAAKC,EAAEC,QAAF,GAAaC,QAAb,CAAsB,GAAtB,EAA2B,CAA3B,CAAL;AAAA,iB;;AACNC,2B,GAAc,oC;AACdC,sB,GAAS;AACbC,0BAAQ,aADK;AAEbC,4BAAU,KAAKX,SAFF;AAGbY,mCAAeR,IAAID,KAAJ,CAAf,SAA6BD;AAHhB,iB;;uBAMQ,8BAClBW,wBADkB,GACFL,WADE,SACaM,sBAAYC,SAAZ,CAAsBN,MAAtB,CADb,EAErB;AACEO,sDACKC,0BADL;AAEEC,4BAAQC,sBAAYC,SAAZ;AAFV;AADF,iBAFqB,C;;;AAAjBC,wB;;uBAUaA,SAASC,IAAT,E;;;AAAbA,oB;AACAC,oB,GAAOC,KAAKC,KAAL,CAAWH,IAAX,C;AAEPI,uB,GAAUH,KAAKI,SAAL,CAAeC,KAAf,CAAqB,CAArB,EAAwBC,OAAxB,CAAgCC,IAAhC,CACd;AAAA,yBAAKzB,EAAE0B,SAAF,IAAe1B,EAAE0B,SAAF,CAAYC,QAAZ,CAAqB,gBAArB,CAApB;AAAA,iBADc,C;iDAGTN,QAAQO,OAAR,CACJC,GADI,CACA;AAAA,yBAAKC,EAAEC,WAAP;AAAA,iBADA,EAEJC,MAFI,CAEG;AAAA,yBAAQC,KAAK,CAAL,EAAQF,WAAR,CAAoB,CAApB,EAAuBG,KAAvB,KAAiC,KAAzC;AAAA,iBAFH,EAGJL,GAHI,CAGA;AAAA,yBAAM;AACTM,0BAAM,IAAIC,IAAJ,CAASvC,IAAT,EAAeC,QAAQ,CAAvB,EAA0BgC,EAAE,CAAF,EAAKC,WAAL,CAAiB,CAAjB,EAAoBG,KAA9C,CADG;AAETtC,iCAAa,+BAAiBkC,EAAE,CAAF,EAAKC,WAAL,CAAiB,CAAjB,EAAoBG,KAArC,CAFJ;AAGTG,4BAAQ,gCAAkBP,EAAE,CAAF,EAAKC,WAAL,CAAiB,CAAjB,EAAoBG,KAAtC;AAHC,mBAAN;AAAA,iBAHA,C;;;;;;;;;;;;;;;;;;;;kBA/BUxC,gB","file":"savingsAccount.js","sourcesContent":["import fetch from 'node-fetch';\nimport querystring from 'querystring';\nimport LoginCookie from '../loginCookie';\nimport { BASE_ENDPOINT, DEFAULT_HEADERS } from '../constants';\nimport { treatDescription, parseAmountString } from '../helpers';\n\nexport default class BBSavingsAccount {\n  constructor({ variation, description }) {\n    this.variation = variation;\n    this.description = description;\n  }\n\n  async getTransactions({ year, month }) {\n    const pad = s => s.toString().padStart('0', 2);\n    const accountsUrl = 'tela/ExtratoDePoupanca/menuPeriodo';\n    const params = {\n      metodo: 'mesAnterior',\n      variacao: this.variation,\n      periodo: `01/${pad(month)}/${year}`,\n    };\n\n    const response = await fetch(\n      `${BASE_ENDPOINT}${accountsUrl}?${querystring.stringify(params)}`,\n      {\n        headers: {\n          ...DEFAULT_HEADERS,\n          cookie: LoginCookie.getGlobal(),\n        },\n      },\n    );\n\n    const text = await response.text();\n    const json = JSON.parse(text);\n\n    const session = json.conteiner.telas[0].sessoes.find(\n      s => s.cabecalho && s.cabecalho.includes('Mês referência'),\n    );\n    return session.celulas\n      .map(c => c.componentes)\n      .filter(comp => comp[0].componentes[0].texto !== 'Dia')\n      .map(c => ({\n        date: new Date(year, month - 1, c[0].componentes[0].texto),\n        description: treatDescription(c[1].componentes[0].texto),\n        amount: parseAmountString(c[2].componentes[0].texto),\n      }));\n  }\n}\n"]}