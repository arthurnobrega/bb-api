{"version":3,"sources":["../../src/savings/savingsAccount.js"],"names":["isCurrentMonth","year","month","now","Date","getFullYear","parseInt","getMonth","BBSavingsAccount","variation","description","pad","s","toString","padStart","accountsUrl","params","variacao","metodo","periodo","BASE_ENDPOINT","querystring","stringify","headers","DEFAULT_HEADERS","cookie","LoginCookie","getGlobal","response","text","json","JSON","parse","session","conteiner","telas","sessoes","find","cabecalho","includes","celulas","filter","c","componentes","length","texto","map","date","amount"],"mappings":"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","sourcesContent":["import fetch from 'node-fetch';\nimport querystring from 'querystring';\nimport LoginCookie from '../loginCookie';\nimport { BASE_ENDPOINT, DEFAULT_HEADERS } from '../constants';\nimport { treatDescription, parseAmountString } from '../helpers';\n\nfunction isCurrentMonth({ year, month }) {\n  const now = new Date();\n  return (\n    now.getFullYear() === parseInt(year, 10) &&\n    now.getMonth() === parseInt(month - 1, 10)\n  );\n}\n\nexport default class BBSavingsAccount {\n  constructor({ variation, description }) {\n    this.variation = variation;\n    this.description = description;\n  }\n\n  async getTransactions({ year, month }) {\n    const pad = s => s.toString().padStart('0', 2);\n    const accountsUrl = 'tela/ExtratoDePoupanca/menuPeriodo';\n\n    let params = {\n      variacao: this.variation,\n    };\n\n    if (!isCurrentMonth({ year, month })) {\n      params = {\n        ...params,\n        metodo: 'mesAnterior',\n        periodo: `01/${pad(month)}/${year}`,\n      };\n    }\n\n    const response = await fetch(\n      `${BASE_ENDPOINT}${accountsUrl}?${querystring.stringify(params)}`,\n      {\n        headers: {\n          ...DEFAULT_HEADERS,\n          cookie: LoginCookie.getGlobal(),\n        },\n      },\n    );\n\n    const text = await response.text();\n    const json = JSON.parse(text);\n\n    const session = json.conteiner.telas[0].sessoes.find(\n      s => s.cabecalho && s.cabecalho.includes('Mês referência'),\n    );\n    return session.celulas\n      .filter(\n        c =>\n          c.componentes.length === 3 &&\n          c.componentes[0].componentes[0].texto !== '' &&\n          c.componentes[1].componentes[0].texto !== '' &&\n          c.componentes[2].componentes[0].texto !== '',\n      )\n      .filter(c => c.componentes[0].componentes[0].texto !== 'Dia')\n      .map(c => {\n        const date = c.componentes[0].componentes[0].texto;\n        const description = c.componentes[1].componentes[0].texto;\n        const amount = c.componentes[2].componentes[0].texto;\n\n        return {\n          date: new Date(year, month - 1, date),\n          description: treatDescription(description),\n          amount: parseAmountString(amount),\n        };\n      });\n  }\n}\n"],"file":"savingsAccount.js"}